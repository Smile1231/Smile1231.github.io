{
    "version": "https://jsonfeed.org/version/1",
    "title": "JIN MAO 's Blog • All posts by \"文件上传\" tag",
    "description": "",
    "home_page_url": "https://smile1231.github.io",
    "items": [
        {
            "id": "https://smile1231.github.io/posts/a1926332/",
            "url": "https://smile1231.github.io/posts/a1926332/",
            "title": "Springboot+Vue二进制文件传输",
            "date_published": "2022-05-21T13:42:10.000Z",
            "content_html": "<p>最近用到了<code>springboot</code>项目返回二进制流，话不多说，代码贴上:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(value = &quot;/file/&#123;fileName&#125;&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ResponseEntity&lt;FileSystemResource&gt; <span class=\"title\">getFile</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;fileName&quot;)</span> String fileName)</span> <span class=\"keyword\">throws</span> FileNotFoundException </span>&#123;</span><br><span class=\"line\">\tFile file = <span class=\"keyword\">new</span> File(filePath, fileName);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (file.exists()) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> export(file);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tSystem.out.println(file);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ResponseEntity&lt;FileSystemResource&gt; <span class=\"title\">export</span><span class=\"params\">(File file)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (file == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tHttpHeaders headers = <span class=\"keyword\">new</span> HttpHeaders();</span><br><span class=\"line\">\theaders.add(<span class=\"string\">&quot;Cache-Control&quot;</span>, <span class=\"string\">&quot;no-cache, no-store, must-revalidate&quot;</span>);</span><br><span class=\"line\">\theaders.add(<span class=\"string\">&quot;Content-Disposition&quot;</span>, <span class=\"string\">&quot;attachment; filename=&quot;</span> + file.getName());</span><br><span class=\"line\">\theaders.add(<span class=\"string\">&quot;Pragma&quot;</span>, <span class=\"string\">&quot;no-cache&quot;</span>);</span><br><span class=\"line\">\theaders.add(<span class=\"string\">&quot;Expires&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">\theaders.add(<span class=\"string\">&quot;Last-Modified&quot;</span>, <span class=\"keyword\">new</span> Date().toString());</span><br><span class=\"line\">\theaders.add(<span class=\"string\">&quot;ETag&quot;</span>, String.valueOf(System.currentTimeMillis()));</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ResponseEntity.ok()</span><br><span class=\"line\">                        .headers(headers)</span><br><span class=\"line\">                        .contentLength(file.length())</span><br><span class=\"line\">                        .contentType(MediaType.parseMediaType(<span class=\"string\">&quot;application/octet-stream&quot;</span>))</span><br><span class=\"line\">                        .body(<span class=\"keyword\">new</span> FileSystemResource(file));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<p>前端<code>Vue</code>代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">downloadXLSXFile() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">\tthat.axios</span><br><span class=\"line\">\t.post(</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;/download/XLSXExampleFile&quot;</span>,</span><br><span class=\"line\">\t\t&#123; fileId: <span class=\"number\">123</span> &#125;, <span class=\"comment\">//入参</span></span><br><span class=\"line\">\t\t&#123; responseType: <span class=\"string\">&quot;blob&quot;</span> &#125; <span class=\"comment\">// 设置responseType对象格式为 blob:</span></span><br><span class=\"line\">\t)</span><br><span class=\"line\">\t.then((res) =&gt; &#123;</span><br><span class=\"line\">\t\tlet blob = <span class=\"keyword\">new</span> Blob([res.data], &#123;</span><br><span class=\"line\">\t\ttype: <span class=\"string\">&quot;application/octet-stream&quot;</span>,</span><br><span class=\"line\">\t\t&#125;); <span class=\"comment\">// 获取请求返回的response对象中的blob 设置文件类型</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tlet url = window.URL.createObjectURL(blob); <span class=\"comment\">// 创建一个临时的url指向blob对象</span></span><br><span class=\"line\">\t\tlet a = document.createElement(<span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">\t\ta.href = url;</span><br><span class=\"line\">\t\ta.download = <span class=\"string\">&quot;text.xslx&quot;</span>; <span class=\"comment\">//下载的文件名</span></span><br><span class=\"line\">\t\ta.click();</span><br><span class=\"line\">\t\twindow.URL.revokeObjectURL(url); <span class=\"comment\">//释放blob对象</span></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>同时贴一个<code>Springboot</code>接受前端`Vue``对象参数</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/business&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SubmitController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> SubmitService submitService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/submit&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ResultVO <span class=\"title\">submitAction</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> UploadFileSubmitEntity uploadFileSubmitEntity)</span></span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;start submitAction ...&quot;</span>);</span><br><span class=\"line\">        log.info(uploadFileSubmitEntity.toString());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> submitService.submitAction(uploadFileSubmitEntity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UploadFileSubmitEntity</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//gz 文件列表</span></span><br><span class=\"line\">    <span class=\"meta\">@JsonProperty(&quot;GZFileList&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ArrayList&lt;UploadRes&gt; GZFileList;</span><br><span class=\"line\">    <span class=\"comment\">//xlsx 文件列表</span></span><br><span class=\"line\">    <span class=\"meta\">@JsonProperty(&quot;XLSXFileList&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ArrayList&lt;UploadRes&gt; XLSXFileList;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>前端:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> that = <span class=\"built_in\">this</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> param = &#123;</span><br><span class=\"line\">\t<span class=\"string\">&quot;GZFileList&quot;</span>: <span class=\"built_in\">this</span>.GZFileList,</span><br><span class=\"line\">\t<span class=\"string\">&quot;XLSXFileList&quot;</span>: <span class=\"built_in\">this</span>.XLSXFileList,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">that.axios(&#123;</span><br><span class=\"line\">\t<span class=\"attr\">method</span>: <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">url</span>: <span class=\"string\">&quot;/business/submit&quot;</span>,</span><br><span class=\"line\">\t<span class=\"attr\">data</span>: <span class=\"built_in\">JSON</span>.stringify(param),</span><br><span class=\"line\">\t<span class=\"attr\">headers</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;application/json;charset=UTF-8&quot;</span>,</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\t.then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(res.data.code == <span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">\t\tthat.$message.success(<span class=\"string\">&quot;submit successfully! , Plz wait for some time .&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n",
            "tags": [
                "SpringBoot",
                "文件上传"
            ]
        }
    ]
}
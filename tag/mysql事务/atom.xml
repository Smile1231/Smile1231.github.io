<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://smile1231.github.io</id>
    <title>JIN MAO &#39;s Blog • Posts by &#34;mysql事务&#34; tag</title>
    <link href="https://smile1231.github.io" />
    <updated>2022-02-10T15:38:00.000Z</updated>
    <category term="生物信息" />
    <category term="基因编辑" />
    <category term="SAP" />
    <category term="前端" />
    <category term="Css" />
    <category term="Java" />
    <category term="Cache" />
    <category term="Cookie" />
    <category term="Session" />
    <category term="Java面试" />
    <category term="DDD" />
    <category term="领域驱动设计" />
    <category term="DisPlay属性" />
    <category term="Docker" />
    <category term="Corn" />
    <category term="blog" />
    <category term="hexo" />
    <category term="next" />
    <category term="IDEA" />
    <category term="FastJson" />
    <category term="SpringBoot" />
    <category term="JavaScript" />
    <category term="Html" />
    <category term="Jvm" />
    <category term="函数式接口" />
    <category term="Jenkins" />
    <category term="CI/CD" />
    <category term="java" />
    <category term="calender" />
    <category term="map" />
    <category term="Stream流" />
    <category term="Springboot" />
    <category term="Assert" />
    <category term="Python" />
    <category term="Jupyter" />
    <category term="Machine Learning" />
    <category term="LeetCode" />
    <category term="算法" />
    <category term="递归" />
    <category term="numpy" />
    <category term="pandas" />
    <category term="sklearn" />
    <category term="Mybatis" />
    <category term="Linux" />
    <category term="分页查询" />
    <category term="Nginx" />
    <category term="Spring" />
    <category term="模糊查询" />
    <category term="Spoken English" />
    <category term="SrpingBoot" />
    <category term="事务" />
    <category term="TypeScript" />
    <category term="WebPack" />
    <category term="master" />
    <category term="文件上传" />
    <category term="Groovy" />
    <category term="UML" />
    <category term="Ubuntu" />
    <category term="Mysql" />
    <category term="VsCode" />
    <category term="Shell" />
    <category term="VSCODE" />
    <category term="快捷键" />
    <category term="Vue" />
    <category term="Stream" />
    <category term="git" />
    <category term="日期" />
    <category term="线程池" />
    <category term="ubuntu" />
    <category term="虚拟机" />
    <category term="二分查找" />
    <category term="数据挖掘" />
    <category term="Hadoop" />
    <category term="操作系统" />
    <category term="EasyExcel" />
    <category term="node" />
    <category term="JVM" />
    <category term="Yaml" />
    <category term="junit" />
    <category term="Hexo" />
    <category term="数据库" />
    <category term="Mysql事务" />
    <category term="Git" />
    <category term="冒泡排序" />
    <category term="动态规划" />
    <category term="git,npm,node" />
    <category term="Google" />
    <category term="多线程" />
    <category term="堆排序" />
    <category term="幂等性" />
    <category term="流" />
    <category term="快速排序" />
    <category term="归并排序" />
    <category term="正则表达式" />
    <category term="直接插入排序" />
    <category term="vue" />
    <category term="选择排序" />
    <category term="Java 面试" />
    <category term="数据结构" />
    <category term="阻塞队列" />
    <category term="Spring事务" />
    <category term="JDK" />
    <category term="动态代理" />
    <category term="Date" />
    <category term="ArrayList" />
    <category term="接口" />
    <category term="SpringMvc" />
    <category term="排序" />
    <category term="执行计划" />
    <category term="HashMap" />
    <category term="Email" />
    <category term="设计模式" />
    <category term="cheatsheet" />
    <entry>
        <id>https://smile1231.github.io/posts/69c17d37/</id>
        <title>关于事务提交中踩坑</title>
        <link rel="alternate" href="https://smile1231.github.io/posts/69c17d37/"/>
        <content type="html">&lt;p&gt;今天在处理一个问题时始终都没有头绪，主要场景是自己的方法中最后需要调用别人的方法进行回调，但是又同时处在一个大事务中，主要我做了以下场景来模拟&lt;/p&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;p&gt;数据库表结构：&lt;/p&gt;
&lt;img data-src=&#34;/posts/69c17d37/2022-02-10-23-42-40.png&#34; class=&#34;&#34;&gt;
&lt;p&gt;测试代码：&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@SpringBootTest&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;class&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;StudentMapperTest&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; StudentDao studentDao;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Test&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Transactional(rollbackFor = Exception.class)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Rollback(false)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;context01&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//查询张三&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        LambdaUpdateWrapper&amp;lt;Student&amp;gt; updateWrapper0 = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; LambdaUpdateWrapper&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        updateWrapper0.eq(Student::getName,&lt;span class=&#34;string&#34;&gt;&amp;quot;张三&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        List&amp;lt;Student&amp;gt; students = studentDao.selectList(updateWrapper0);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//对张三进行修改为张三改&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        LambdaUpdateWrapper&amp;lt;Student&amp;gt; updateWrapper = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; LambdaUpdateWrapper&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        updateWrapper.eq(Student::getName,&lt;span class=&#34;string&#34;&gt;&amp;quot;张三&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .set(Student::getName,&lt;span class=&#34;string&#34;&gt;&amp;quot;张三改&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        studentDao.update(Student.builder().build(), updateWrapper);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//再度查询张三&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        LambdaUpdateWrapper&amp;lt;Student&amp;gt; updateWrapper1 = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; LambdaUpdateWrapper&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        updateWrapper1.eq(Student::getName,&lt;span class=&#34;string&#34;&gt;&amp;quot;张三&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        List&amp;lt;Student&amp;gt; students1 = studentDao.selectList(updateWrapper1);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//尝试查询修改后的张三改&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        LambdaUpdateWrapper&amp;lt;Student&amp;gt; updateWrapper2 = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; LambdaUpdateWrapper&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        updateWrapper2.eq(Student::getName,&lt;span class=&#34;string&#34;&gt;&amp;quot;张三改&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        List&amp;lt;Student&amp;gt; students2 = studentDao.selectList(updateWrapper2);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;debug&lt;/code&gt;  结果：&lt;/p&gt;
&lt;img data-src=&#34;/posts/69c17d37/2022-02-10-23-47-46.png&#34; class=&#34;&#34;&gt;
&lt;img data-src=&#34;/posts/69c17d37/2022-02-10-23-47-01.png&#34; class=&#34;&#34;&gt;
&lt;p&gt;&lt;strong&gt;我们可以得到虽然事务没有提交但是同一会话查询时依然是修改后的值，但是此时如果为多线程下，别的线程将不会读取到提交事物之前的结果，这就是数据库的隔离性问题&lt;/strong&gt;，此时事务没有提交，数据库结果未改变&lt;/p&gt;
&lt;img data-src=&#34;/posts/69c17d37/2022-02-10-23-50-42.png&#34; class=&#34;&#34;&gt;
&lt;p&gt;当然，只有当程序正常运行结束之后，事务才会提交，数据库才会改变：&lt;/p&gt;
&lt;img data-src=&#34;/posts/69c17d37/2022-02-10-23-51-07.png&#34; class=&#34;&#34;&gt;
</content>
        <category term="Java" />
        <category term="Mysql事务" />
        <updated>2022-02-10T15:38:00.000Z</updated>
    </entry>
</feed>

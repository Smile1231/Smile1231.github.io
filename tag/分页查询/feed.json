{
    "version": "https://jsonfeed.org/version/1",
    "title": "JIN MAO 's Blog • All posts by \"分页查询\" tag",
    "description": "",
    "home_page_url": "https://smile1231.github.io",
    "items": [
        {
            "id": "https://smile1231.github.io/posts/2edf7887/",
            "url": "https://smile1231.github.io/posts/2edf7887/",
            "title": "MybatisPlus实现分页查询",
            "date_published": "2022-02-13T13:41:49.000Z",
            "content_html": "<h1 id=\"MybatisPlus实现分页查询\"><a href=\"#MybatisPlus实现分页查询\" class=\"headerlink\" title=\"MybatisPlus实现分页查询\"></a><code>MybatisPlus</code>实现分页查询</h1><h2 id=\"分页区别\"><a href=\"#分页区别\" class=\"headerlink\" title=\"分页区别\"></a>分页区别</h2><p>分页查询每个人程序猿几乎都使用过，但是有部分同学不懂什么是物理分页和逻辑分页。</p>\n<p>物理分页：相当于执行了<code>limit</code>分页语句，返回部分数据。物理分页只返回部分数据占用内存小，能够获取数据库最新的状态，实施性比较强，一般适用于数据量比较大，数据更新比较频繁的场景。</p>\n<p>逻辑分页：一次性把全部的数据取出来，通过程序进行筛选数据。如果数据量大的情况下会消耗大量的内存，由于逻辑分页只需要读取数据库一次，不能获取数据库最新状态，实施性比较差，适用于数据量小，数据稳定的场合。</p>\n<p>那么MP中的物理分页怎么实现呢？ 往下看往下看</p>\n<span id=\"more\"></span>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>需要新建一个<code>JavaConfig</code>类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBatisPlusConfig</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 分页插件</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> PaginationInterceptor <span class=\"title\">paginationInterceptor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PaginationInterceptor();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"具体分页实现\"><a href=\"#具体分页实现\" class=\"headerlink\" title=\"具体分页实现\"></a>具体分页实现</h2><p><code>MP</code>的<code>Wrapper</code>提供了两种分页查询的方式，源码如下：</p>\n<img data-src=\"/blog/posts/2edf7887/2022-02-13-22-35-05.png\" class=\"\">\n\n<p>可见两个分页方法参数都是一致的，只是返回参数略有不同，具体选择根据实际业务为准。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 分页查询</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">selectByPage</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    QueryWrapper&lt;User&gt; wrapper = <span class=\"keyword\">new</span> QueryWrapper();</span><br><span class=\"line\">    wrapper.like(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;雨&quot;</span>).lt(<span class=\"string\">&quot;age&quot;</span>, <span class=\"number\">40</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    Page&lt;User&gt; page = <span class=\"keyword\">new</span> Page&lt;&gt;(<span class=\"number\">1</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//IPage&lt;User&gt; userIPage = userMapper.selectPage(page, wrapper);</span></span><br><span class=\"line\"></span><br><span class=\"line\">    IPage&lt;Map&lt;String, Object&gt;&gt; mapIPage = userMapper.selectMapsPage(page, wrapper);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;总页数&quot;</span>+mapIPage.getPages());</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;总记录数&quot;</span>+mapIPage.getTotal());</span><br><span class=\"line\">    List&lt;Map&lt;String, Object&gt;&gt; records = mapIPage.getRecords();</span><br><span class=\"line\">    records.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以上分页查询执行<code>sql</code>如下，先是查询了一次总记录数，然后在查询的数据。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEBUG<span class=\"operator\">=</span><span class=\"operator\">=</span><span class=\"operator\">&gt;</span>  Preparing: <span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"number\">1</span>) <span class=\"keyword\">FROM</span> <span class=\"keyword\">user</span> <span class=\"keyword\">WHERE</span> name <span class=\"keyword\">LIKE</span> ? <span class=\"keyword\">AND</span> age <span class=\"operator\">&lt;</span> ? </span><br><span class=\"line\">DEBUG<span class=\"operator\">=</span><span class=\"operator\">=</span><span class=\"operator\">&gt;</span> Parameters: <span class=\"operator\">%</span>雨<span class=\"operator\">%</span>(String), <span class=\"number\">40</span>(<span class=\"type\">Integer</span>)</span><br><span class=\"line\">TRACE<span class=\"operator\">&lt;=</span><span class=\"operator\">=</span>    Columns: <span class=\"built_in\">COUNT</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">TRACE<span class=\"operator\">&lt;=</span><span class=\"operator\">=</span>        <span class=\"type\">Row</span>: <span class=\"number\">2</span></span><br><span class=\"line\">DEBUG<span class=\"operator\">=</span><span class=\"operator\">=</span><span class=\"operator\">&gt;</span>  Preparing: <span class=\"keyword\">SELECT</span> id,name,age,email,manager_id,create_time <span class=\"keyword\">FROM</span> <span class=\"keyword\">user</span> <span class=\"keyword\">WHERE</span> name <span class=\"keyword\">LIKE</span> ? <span class=\"keyword\">AND</span> age <span class=\"operator\">&lt;</span> ? LIMIT ?,? </span><br><span class=\"line\">DEBUG<span class=\"operator\">=</span><span class=\"operator\">=</span><span class=\"operator\">&gt;</span> Parameters: <span class=\"operator\">%</span>雨<span class=\"operator\">%</span>(String), <span class=\"number\">40</span>(<span class=\"type\">Integer</span>), <span class=\"number\">0</span>(Long), <span class=\"number\">2</span>(Long)</span><br><span class=\"line\">TRACE<span class=\"operator\">&lt;=</span><span class=\"operator\">=</span>    Columns: id, name, age, email, manager_id, create_time</span><br><span class=\"line\">TRACE<span class=\"operator\">&lt;=</span><span class=\"operator\">=</span>        <span class=\"type\">Row</span>: <span class=\"number\">2</span>, 张雨琪, <span class=\"number\">31</span>, zjq<span class=\"variable\">@baomidou</span>.com, <span class=\"number\">1088248166370832385</span>, <span class=\"number\">2021</span><span class=\"number\">-01</span><span class=\"number\">-14</span> <span class=\"number\">09</span>:<span class=\"number\">15</span>:<span class=\"number\">15</span></span><br><span class=\"line\">TRACE<span class=\"operator\">&lt;=</span><span class=\"operator\">=</span>        <span class=\"type\">Row</span>: <span class=\"number\">3</span>, 刘红雨, <span class=\"number\">31</span>, lhm<span class=\"variable\">@baomidou</span>.com, <span class=\"number\">1088248166370832385</span>, <span class=\"number\">2021</span><span class=\"number\">-01</span><span class=\"number\">-14</span> <span class=\"number\">09</span>:<span class=\"number\">48</span>:<span class=\"number\">16</span></span><br><span class=\"line\">DEBUG<span class=\"operator\">&lt;=</span><span class=\"operator\">=</span>      Total: <span class=\"number\">2</span></span><br><span class=\"line\">总页数<span class=\"number\">1</span></span><br><span class=\"line\">总记录数<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<p>现在我们有需求只要查询数据即可， 不关心总记录数等，如果使用默认的方式就消耗不必要的性能。那么解决办法也是很简单的，只需要在创建<code>page</code>对象时传入第三个参数为<code>false</code>即可。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page&lt;User&gt; page = <span class=\"keyword\">new</span> Page&lt;&gt;(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"keyword\">false</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n\n",
            "tags": [
                "Java",
                "SpringBoot",
                "Mybatis",
                "分页查询"
            ]
        },
        {
            "id": "https://smile1231.github.io/posts/31dc52e1/",
            "url": "https://smile1231.github.io/posts/31dc52e1/",
            "title": "MyBatis之分页查询：MyBatis PageHelper",
            "date_published": "2022-02-13T13:40:27.000Z",
            "content_html": "<h1 id=\"MyBatis之分页查询：MyBatis-PageHelper\"><a href=\"#MyBatis之分页查询：MyBatis-PageHelper\" class=\"headerlink\" title=\"MyBatis之分页查询：MyBatis PageHelper\"></a><code>MyBatis</code>之分页查询：<code>MyBatis PageHelper</code></h1><h2 id=\"1-添加依赖\"><a href=\"#1-添加依赖\" class=\"headerlink\" title=\"1. 添加依赖\"></a>1. 添加依赖</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--MyBatis 分页插件: MyBatis PageHelper--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.pagehelper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"2-添加配置\"><a href=\"#2-添加配置\" class=\"headerlink\" title=\"2. 添加配置\"></a>2. 添加配置</h2><span id=\"more\"></span>\n\n<p>在<code>application.properties</code>配置文件中添加<code>MyBatis PageHelper</code>的配置项</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PageHelper 分页插件配置</span></span><br><span class=\"line\"><span class=\"meta\">pagehelper.helperDialect</span>=<span class=\"string\">mysql</span></span><br><span class=\"line\"><span class=\"meta\">pagehelper.reasonable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"meta\">pagehelper.supportMethodsArguments</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"meta\">pagehelper.params</span>=<span class=\"string\">count=countSql</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-分页查询\"><a href=\"#3-分页查询\" class=\"headerlink\" title=\"3. 分页查询\"></a>3. 分页查询</h2><p>通过 <code>MyBatis PageHelper</code> 进行分页查询实际上非常简单，只需在<code>service(或mapper)</code>方法执行查询前，调用一次 <code>PageHelper.startPage(pageNum,pageSize)</code> <code>来设置分页查询参数即可，其中pageNum</code> 为记录页数，<code>pageSize</code> 为单页记录数量。此时<code>service(或mapper)</code>方法的查询结果就是分页后的结果了。如果期望获得相关的分页信息，还可以将查询结果封装到<code>PageInfo</code>对象中，以获得总页数、总记录数、当前页数等相关分页信息</p>\n<p>现在通过一个实际示例，来具体演示操作，这里我们提供了一个分页查询的<code>Controller</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 分页查询</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> pageNum 记录页数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> pageSize 单页记录数量</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/findPage&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;Student&gt; <span class=\"title\">findPage</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> <span class=\"keyword\">int</span> pageNum, <span class=\"meta\">@RequestParam</span> <span class=\"keyword\">int</span> pageSize)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 设置分页查询参数</span></span><br><span class=\"line\">    PageHelper.startPage(pageNum,pageSize);</span><br><span class=\"line\">    List&lt;Student&gt; studentList = studentService.findList();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Student student : studentList) &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;element : &quot;</span> + student);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 封装分页查询结果到 PageInfo 对象中以获取相关分页信息</span></span><br><span class=\"line\">    PageInfo pageInfo = <span class=\"keyword\">new</span> PageInfo( studentList );</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;总页数: &quot;</span> + pageInfo.getPages());</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;总记录数: &quot;</span> + pageInfo.getTotal());</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;当前页数: &quot;</span> + pageInfo.getPageNum());</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;当前页面记录数量: &quot;</span> + pageInfo.getSize());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> pageInfo.getList();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>service</code>方法中所调用的查询<code>SQL</code>如下所示，可以看到，<code>SQL</code>中无需使用<code>limit</code>语句</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;studentResultMap&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;com.aaron.springbootdemo.pojo.Student&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;id&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;id&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;sex&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;sex&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;address&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;address&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;findList&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;String&quot;</span> <span class=\"attr\">resultMap</span>=<span class=\"string\">&quot;studentResultMap&quot;</span>&gt;</span>    </span><br><span class=\"line\">    SELECT * FROM user</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><code>NOTE:</code> </p>\n</blockquote>\n<p><code>PageHelper.startPage(pageNum,pageSize)</code> 只对其后的第一次<code>SQL</code>查询进行分页。故若需进行分页查询，必须每次在<code>service（或mapper）</code>方法执行<code>SQL</code>查询前调用<code>PageHelper.startPage(pageNum,pageSize) </code>方法</p>\n",
            "tags": [
                "Java",
                "SpringBoot",
                "Mybatis",
                "分页查询"
            ]
        }
    ]
}